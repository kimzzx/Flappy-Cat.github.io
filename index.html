<script>
/* ===== FIXED GAME SCRIPT (NO UI CHANGE) ===== */

let gameState = {
  isPlaying:false,
  score:0,
  lives:3,
  catY:50,
  catVelocity:0,
  fruits:[],
  targetFruit:null,
  loop:null,
  spawn:null
};

const FRUITS = ['ðŸŽ','ðŸŠ','ðŸ‹','ðŸ‡','ðŸ“','ðŸ‘','ðŸ¥','ðŸ’'];
const GRAVITY = 0.4;
const JUMP = -8;
const SPEED = 0.9;

/* DOM */
const startScreen = document.getElementById('startScreen');
const gameScreen = document.getElementById('gameScreen');
const gameOverScreen = document.getElementById('gameOverScreen');
const startBtn = document.getElementById('startBtn');
const restartBtn = document.getElementById('restartBtn');
const cat = document.getElementById('cat');
const fruitsContainer = document.getElementById('fruitsContainer');
const scoreEl = document.getElementById('score');
const livesEl = document.getElementById('lives');
const targetFruitEl = document.getElementById('targetFruit');
const finalScoreEl = document.getElementById('finalScore');

/* START */
function startGame(){
  gameState = {
    isPlaying:true,
    score:0,
    lives:3,
    catY:50,
    catVelocity:0,
    fruits:[],
    targetFruit:FRUITS[Math.floor(Math.random()*FRUITS.length)]
  };

  scoreEl.textContent = 0;
  livesEl.textContent = 'â¤ï¸â¤ï¸â¤ï¸';
  targetFruitEl.textContent = gameState.targetFruit;
  fruitsContainer.innerHTML = '';

  startScreen.classList.add('hidden');
  gameOverScreen.classList.add('hidden');
  gameScreen.classList.remove('hidden');

  gameState.loop = requestAnimationFrame(loop);
  gameState.spawn = setInterval(spawnFruit,1200);
}

/* FRUIT */
function spawnFruit(){
  if(!gameState.isPlaying) return;

  const fruit = {
    id: Date.now()+Math.random(),
    emoji: FRUITS[Math.floor(Math.random()*FRUITS.length)],
    x:100,
    y:10+Math.random()*70
  };

  gameState.fruits.push(fruit);

  const el = document.createElement('div');
  el.id = `fruit-${fruit.id}`;
  el.className = 'absolute text-5xl fruit-sparkle';
  el.textContent = fruit.emoji;
  el.style.left = `${fruit.x}%`;
  el.style.top = `${fruit.y}%`;
  fruitsContainer.appendChild(el);
}

/* INPUT */
function jump(){
  if(gameState.isPlaying) gameState.catVelocity = JUMP;
}

/* LOOP */
function loop(){
  if(!gameState.isPlaying) return;

  gameState.catVelocity += GRAVITY;
  gameState.catY += gameState.catVelocity*0.5;
  gameState.catY = Math.max(5,Math.min(85,gameState.catY));

  cat.style.top = `${gameState.catY}%`;
  cat.style.transform = `rotate(${gameState.catVelocity*3}deg)`;

  gameState.fruits.forEach((f,i)=>{
    f.x -= SPEED;
    const el = document.getElementById(`fruit-${f.id}`);
    if(!el) return;

    el.style.left = `${f.x}%`;

    const hit = Math.abs(f.x-15)<7 && Math.abs(f.y-gameState.catY)<9;
    if(hit){
      if(f.emoji===gameState.targetFruit){
        gameState.score += 10;
        gameState.targetFruit = FRUITS[Math.floor(Math.random()*FRUITS.length)];
        targetFruitEl.textContent = gameState.targetFruit;
      }else{
        gameState.lives--;
        livesEl.textContent = 'â¤ï¸'.repeat(gameState.lives);
      }

      scoreEl.textContent = gameState.score;
      el.remove();
      gameState.fruits.splice(i,1);

      if(gameState.lives<=0) return endGame();
    }

    if(f.x<-10){
      el.remove();
      gameState.fruits.splice(i,1);
    }
  });

  gameState.loop = requestAnimationFrame(loop);
}

/* END */
function endGame(){
  gameState.isPlaying=false;
  clearInterval(gameState.spawn);
  cancelAnimationFrame(gameState.loop);

  finalScoreEl.textContent = gameState.score;
  gameScreen.classList.add('hidden');
  gameOverScreen.classList.remove('hidden');
}

/* EVENTS */
startBtn.onclick = startGame;
restartBtn.onclick = startGame;
gameScreen.onclick = jump;
document.addEventListener('keydown',e=>{
  if(e.code==='Space' || e.code==='ArrowUp') jump();
});
</script>
